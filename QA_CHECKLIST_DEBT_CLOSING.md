# QA Checklist - סגירת חוב אטומית

## בדיקות חובה לפני שחרור

### 1. בדיקה בסיסית - סגירת חוב

#### שלב 1: הכנה
- [ ] להיכנס לאפליקציה
- [ ] לוודא שיש דירה עם לפחות 2 משתמשים
- [ ] לוודא שיש חובות פתוחים (או ליצור חוב חדש)

#### שלב 2: סגירת חוב
- [ ] ללכת למסך "חובות קבוצתיים"
- [ ] למצוא חוב פתוח
- [ ] ללחוץ על "סגור חוב"
- [ ] לוודא שמופיע modal עם פרטי החוב
- [ ] לוודא שהסכום מוצג נכון
- [ ] ללחוץ "אישור סגירה"

#### שלב 3: בדיקת UI
- [ ] לוודא שמופיע spinner ("סוגר...")
- [ ] לוודא שהכפתור מושבת במהלך הפעולה
- [ ] לוודא שה-modal נסגר אחרי הצלחה
- [ ] לוודא שמופיעה הודעת הצלחה "החוב נסגר בהצלחה!"

### 2. בדיקת בסיס הנתונים

#### בדיקת debts collection
- [ ] לפתוח Firebase Console
- [ ] ללכת ל-Firestore Database
- [ ] לפתוח `debts` collection
- [ ] למצוא את החוב שנסגר
- [ ] לוודא ש-`status` = "closed"
- [ ] לוודא שיש `closed_at` timestamp
- [ ] לוודא שיש `closed_by` עם ה-UID של המשתמש
- [ ] לוודא שיש `cleared_amount` עם הסכום הנכון

#### בדיקת monthlyExpenses collection
- [ ] לפתוח `apartments/{apartmentId}/monthlyExpenses/{YYYY-MM}/expenses`
- [ ] למצוא את הרשומה החדשה
- [ ] לוודא ש-`amount` תואם לסכום החוב
- [ ] לוודא ש-`title` = "סגירת חוב"
- [ ] לוודא ש-`linked_debt_id` תואם ל-ID של החוב
- [ ] לוודא ש-`payer_id` ו-`receiver_id` נכונים
- [ ] לוודא ש-`created_by` = UID של המשתמש

#### בדיקת balances collection
- [ ] לפתוח `balances/{apartmentId}/users/{userId}`
- [ ] לבדוק את ה-balance של המשתמש החייב
- [ ] לוודא שה-balance ירד בסכום החוב
- [ ] לבדוק את ה-balance של המשתמש הזכאי
- [ ] לוודא שה-balance עלה בסכום החוב

#### בדיקת actions collection
- [ ] לפתוח `actions` collection
- [ ] למצוא את הרשומה החדשה
- [ ] לוודא ש-`type` = "close_debt"
- [ ] לוודא ש-`debt_id` תואם ל-ID של החוב
- [ ] לוודא ש-`actor` = UID של המשתמש
- [ ] לוודא ש-`amount` תואם לסכום החוב
- [ ] לוודא ש-`from_user_id` ו-`to_user_id` נכונים

### 3. בדיקת שגיאות

#### בדיקת חוב שכבר סגור
- [ ] לנסות לסגור חוב שכבר סגור
- [ ] לוודא שמופיעה הודעת שגיאה מתאימה
- [ ] לוודא שלא נוצרות רשומות כפולות

#### בדיקת הרשאות
- [ ] להתחבר כמשתמש שאינו חבר בדירה
- [ ] לנסות לסגור חוב
- [ ] לוודא שמופיעה הודעת שגיאה "אין לך הרשאה"

#### בדיקת נתונים חסרים
- [ ] לנסות לסגור חוב עם סכום 0
- [ ] לוודא שמופיעה הודעת שגיאה
- [ ] לנסות לסגור חוב עם סכום שלילי
- [ ] לוודא שמופיעה הודעת שגיאה

### 4. בדיקת כפילות

#### בדיקת לחיצה כפולה
- [ ] ללחוץ פעמיים על "סגור חוב" במהירות
- [ ] לוודא שהפעולה מתבצעת רק פעם אחת
- [ ] לוודא שלא נוצרות רשומות כפולות

#### בדיקת רשת איטית
- [ ] להאט את הרשת (Network throttling)
- [ ] לנסות לסגור חוב
- [ ] לוודא שהפעולה מתבצעת נכון
- [ ] לוודא שה-UI לא קורס

### 5. בדיקת ביצועים

#### בדיקת זמן תגובה
- [ ] למדוד זמן מתחילת הפעולה עד הצגת הצלחה
- [ ] לוודא שהזמן סביר (< 3 שניות)
- [ ] לבדוק עם מספר חובות בו-זמנית

#### בדיקת זיכרון
- [ ] לסגור מספר חובות ברצף
- [ ] לוודא שאין דליפות זיכרון
- [ ] לוודא שה-UI נשאר רספונסיבי

### 6. בדיקת תאימות

#### בדיקת דפדפנים
- [ ] Chrome
- [ ] Firefox  
- [ ] Safari
- [ ] Edge

#### בדיקת מכשירים
- [ ] Desktop
- [ ] Mobile
- [ ] Tablet

### 7. בדיקת אינטגרציה

#### בדיקת מסכים אחרים
- [ ] לוודא שמסך התקציב מעודכן
- [ ] לוודא שמסך הדשבורד מעודכן
- [ ] לוודא שהחובות נעלמים מרשימת החובות הפעילים

#### בדיקת real-time updates
- [ ] לפתוח את האפליקציה במכשיר אחר
- [ ] לסגור חוב במכשיר הראשון
- [ ] לוודא שהמכשיר השני מתעדכן אוטומטית

## בדיקות מתקדמות

### 1. בדיקת edge cases
- [ ] חוב עם סכום גדול מאוד
- [ ] חוב עם סכום קטן מאוד (0.01)
- [ ] חוב עם תווים מיוחדים בתיאור
- [ ] חוב עם משתמשים עם שמות ארוכים

### 2. בדיקת stress testing
- [ ] לסגור 10 חובות ברצף
- [ ] לסגור חובות ממספר משתמשים בו-זמנית
- [ ] לבדוק עם דירה עם הרבה משתמשים

### 3. בדיקת recovery
- [ ] לנתק את הרשת במהלך הפעולה
- [ ] לוודא שהפעולה נכשלת בצורה נקייה
- [ ] לוודא שלא נוצרות רשומות חלקיות

## קריטריונים להצלחה

### חובה (Must Have)
- [ ] כל הפעולות מתבצעות או כולן נכשלות
- [ ] ה-UI מציג הצלחה רק אחרי אישור מהשרת
- [ ] כל הנתונים נכתבים נכון בבסיס הנתונים
- [ ] אין רשומות כפולות
- [ ] הודעות שגיאה ברורות ומתאימות

### רצוי (Should Have)
- [ ] זמן תגובה < 3 שניות
- [ ] תמיכה בכל הדפדפנים הנפוצים
- [ ] עדכונים real-time עובדים
- [ ] UI רספונסיבי במהלך הפעולה

### יכול להיות (Could Have)
- [ ] תמיכה בפעולות batch
- [ ] היסטוריית פעולות מפורטת
- [ ] התראות push על סגירת חובות

## תיעוד שגיאות

אם נמצאות שגיאות, לתעד:

1. **תיאור השגיאה**
2. **שלב שבו התרחשה**
3. **נתונים שהיו בשימוש**
4. **הודעת השגיאה המדויקת**
5. **צעדים לשחזור**
6. **צילום מסך (אם רלוונטי)**

## אישור QA

- [ ] כל הבדיקות הבסיסיות עברו
- [ ] כל הבדיקות המתקדמות עברו
- [ ] אין שגיאות קריטיות
- [ ] הביצועים מקובלים
- [ ] התיעוד מעודכן

**שם הבודק:** _______________
**תאריך:** _______________
**חתימה:** _______________
